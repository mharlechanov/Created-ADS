<!DOCTYPE html>
<html>
  <head>
	<meta charset=utf-8>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <title>UniCredit | Cube Ad</title>
    <style>
		* {	margin: 0;-webkit-touch-callout: none;-moz-user-select: none;-ms-user-select: none;user-select: none;-webkit-tap-highlight-color: transparent;-webkit-user-select: none;}
		html, body { margin: 0; padding: 0; overflow: hidden;}
		body {height:100vh; background-color:#ffffff;}
		canvas { display: block;}
		.top {position: absolute;top: 0;width: 100%; z-index:-1;}
		.bottom {position: absolute;bottom: 0;width: 100%; z-index:-1;}
		img {border: 0;}
    </style>
  </head>
  <body>
	<div id="noLandscape" style="display: none; position: fixed; width: 100%; height: 100%; top: 0px; left: 0px; background-color: rgb(0, 0, 0); text-align: center; z-index: 20000;">
		<div class="content" style="position: relative;width: 80%;height: 230px;margin: 0 auto;top: 50%;margin-top: -115px;font-size: 1.1em; ">
            <img src="images/no-landscape.jpg" style="width: 80%;">
		</div>
	</div>
	
	<img src="images/top.jpg" alt="" class="top">
	<img src="images/bottom.jpg" alt="" class="bottom">
	
	
    <script src="three.min.js"></script>
    <script src="TweenMax.min.js"></script>
    <script>
		function resize() {
			if (window.innerHeight > window.innerWidth) {
				document.getElementById('noLandscape').style.display = "none";
			}else{
				document.getElementById('noLandscape').style.display = "block";
			}
        };
        resize();
		
		var clickLink = "";
		var clickLinkSide1 = "https://servedby.flashtalking.com/click/2/134059;4913014;50126;211;0/?gdpr=${GDPR}&gdpr_consent=${GDPR_CONSENT_78}&gdpr_pd=${GDPR_PD}&us_privacy=${US_PRIVACY}&url=https://www.vivatmo.com/asthma-und-feno/feno-messung/?utm_source=cubead&utm_medium=banner&utm_campaign=flight2";
		var clickLinkSide2 = "https://servedby.flashtalking.com/click/2/134059;4913015;50126;211;0/?gdpr=${GDPR}&gdpr_consent=${GDPR_CONSENT_78}&gdpr_pd=${GDPR_PD}&us_privacy=${US_PRIVACY}&url=https://www.vivatmo.com/asthma-und-feno/feno-und-peak-flow/?utm_source=cubead&utm_medium=banner&utm_campaign=flight2";
		var clickLinkSide3 = "https://servedby.flashtalking.com/click/2/134059;4913016;50126;211;0/?gdpr=${GDPR}&gdpr_consent=${GDPR_CONSENT_78}&gdpr_pd=${GDPR_PD}&us_privacy=${US_PRIVACY}&url=https://www.vivatmo.com/asthma-und-feno/feno-und-peak-flow/?utm_source=cubead&utm_medium=banner&utm_campaign=flight2";
		var clickLinkSide4 = "https://servedby.flashtalking.com/click/2/134059;4913017;50126;211;0/?gdpr=${GDPR}&gdpr_consent=${GDPR_CONSENT_78}&gdpr_pd=${GDPR_PD}&us_privacy=${US_PRIVACY}&url=https://www.vivatmo.com/produkte/vivatmo-me-starterpaket/?utm_source=cubead&utm_medium=banner&utm_campaign=flight2";
		
		function clickout_cta() {
			
			window.open(clickLink);
		};

		function clickout_side1() {
			console.log('CTA: side 1');
			window.open(clickLinkSide1);
		};
		
		function clickout_side2() {
			console.log('CTA: side 4');
			window.open(clickLinkSide4);
		};

		function clickout_side3() {
			console.log('CTA: side 3');
			window.open(clickLinkSide3);
		};

		function clickout_side4() {
			console.log('CTA: side 2');
			window.open(clickLinkSide2);
		};

		var trackImgSide1 = "https://servedby.flashtalking.com/imp/2/134059;4913014;201;pixel;PermodoDE;PermodoDERONPermodoPublisherPoolRunofSiteFullscreenCubeAd140920WMAd1ZPCC/?gdpr=${GDPR}&gdpr_consent=${GDPR_CONSENT_78}&gdpr_pd=${GDPR_PD}&us_privacy=${US_PRIVACY}&cachebuster=[CACHEBUSTER]";
		var trackImgSide2 = "https://servedby.flashtalking.com/imp/2/134059;4913015;201;pixel;PermodoDE;PermodoDERONPermodoPublisherPoolRunofSiteFullscreenCubeAd140920WMAd2ZPCC/?gdpr=${GDPR}&gdpr_consent=${GDPR_CONSENT_78}&gdpr_pd=${GDPR_PD}&us_privacy=${US_PRIVACY}&cachebuster=[CACHEBUSTER]";
		var trackImgSide3 = "https://servedby.flashtalking.com/imp/2/134059;4913016;201;pixel;PermodoDE;PermodoDERONPermodoPublisherPoolRunofSiteFullscreenCubeAd140920WMAd3ZPCC/?gdpr=${GDPR}&gdpr_consent=${GDPR_CONSENT_78}&gdpr_pd=${GDPR_PD}&us_privacy=${US_PRIVACY}&cachebuster=[CACHEBUSTER]";
		var trackImgSide4 = "https://servedby.flashtalking.com/imp/2/134059;4913017;201;pixel;PermodoDE;PermodoDERONPermodoPublisherPoolRunofSiteFullscreenCubeAd140920WMAd4ZPCC/?gdpr=${GDPR}&gdpr_consent=${GDPR_CONSENT_78}&gdpr_pd=${GDPR_PD}&us_privacy=${US_PRIVACY}&cachebuster=[CACHEBUSTER]";
		
		var trackFlagSide1 = true;
		var trackFlagSide2 = true;
		var trackFlagSide3 = true;
		var trackFlagSide4 = true;
		
		function addTrackingScript(trackURL) {
			var img = new Image();
			img.src = trackURL;
		};
		
		function track_cube_side1() {
			if (trackFlagSide1){
				trackFlagSide1 = false;
				console.log('cube_side1');
				addTrackingScript(trackImgSide1);
			}
		};
		function track_cube_side2() {
			if (trackFlagSide2){
				trackFlagSide2 = false;
				console.log('cube_side2');
				addTrackingScript(trackImgSide2);
			}
		};
		function track_cube_side3() {
			if (trackFlagSide3){
				trackFlagSide3 = false;
				console.log('cube_side3');
				addTrackingScript(trackImgSide3);
			}
		};
		function track_cube_side4() {
			if (trackFlagSide4){
				trackFlagSide4 = false;
				console.log('cube_side4');
				addTrackingScript(trackImgSide4);
			}
		};
		
		
		
		
		var targetRotationX = 0;
		var targetRotationOnMouseDownX = 0;

		var targetRotationY = 0;
		var targetRotationOnMouseDownY = 0;

		var mouseX = 0;
		var mouseXOnMouseDown = 0;

		var mouseY = 0;
		var mouseYOnMouseDown = 0;

		var windowHalfX = window.innerWidth / 2;
		var windowHalfY = window.innerHeight / 2;

		var finalRotationY;
		var activeSide = 0;
		var activeSideOld = 0;
		
		var scene = new THREE.Scene();
		
        var camera = new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,0.1,1000);
        
        if(window.innerWidth / window.innerHeight > 0.5){
			camera.position.z = 10;
		} else {
			camera.position.z = 12;
		}
			
        var renderer = new THREE.WebGLRenderer({antialias: true, alpha: true});
        
		renderer.setSize(window.innerWidth,window.innerHeight);
		
        document.body.appendChild(renderer.domElement);
		
		window.addEventListener('resize', () => {
            renderer.setSize(window.innerWidth,window.innerHeight);
            camera.aspect = window.innerWidth / window.innerHeight;
			if(window.innerWidth / window.innerHeight > 0.5){
				camera.position.z = 10;
			} else {
				camera.position.z = 12;
			}
		
            camera.updateProjectionMatrix();
			
			resize();
        });
		
        var raycaster = new THREE.Raycaster();
        var mouse = new THREE.Vector2();
		
		var group = new THREE.Object3D();
		
		var geometry = new THREE.BoxGeometry(5, 5, 5);
		var color = [
			new THREE.MeshBasicMaterial({color:"red"}),
			new THREE.MeshBasicMaterial({color:"blue"}),
			new THREE.MeshBasicMaterial({color:"orange"}),
			new THREE.MeshBasicMaterial({color:"green"}),
			new THREE.MeshBasicMaterial({color:"grey"}),
			new THREE.MeshBasicMaterial({color:"black"}),
		];
		
		var texture0 = new THREE.TextureLoader().load( 'images/2.jpg' );
		var texture1 = new THREE.TextureLoader().load( 'images/4.jpg' );
		var texture2 = new THREE.TextureLoader().load( 'images/0.jpg' );
		var texture3 = new THREE.TextureLoader().load( 'images/0.jpg' );
		var texture4 = new THREE.TextureLoader().load( 'images/1.jpg' );
		var texture5 = new THREE.TextureLoader().load( 'images/3.jpg' );

		var materials = [
			new THREE.MeshBasicMaterial( { map: texture0 } ),
			new THREE.MeshBasicMaterial( { map: texture1 } ),
			new THREE.MeshBasicMaterial( { map: texture2 } ),
			new THREE.MeshBasicMaterial( { map: texture3 } ),
			new THREE.MeshBasicMaterial( { map: texture4 } ),
			new THREE.MeshBasicMaterial( { map: texture5 } )
			];
			
		
		
        var mesh = new THREE.Mesh(geometry, materials);
		
		group.position.set(0,0.1,0);
		
		group.add(mesh);
        scene.add(group);
		
		var anim0 = new TimelineMax({ repeat:0 })
			.to(mesh.rotation, 1, {y: -Math.PI/8, ease: Power0.easeNone, delay: 1})
			.to(mesh.rotation, 2, {y: Math.PI/8, ease: Power0.easeNone, delay: 0})
			.to(mesh.rotation, 2, {y: 0, ease: Power0.easeNone, delay: 0, onComplete: setAnim});
		
		function setAnim(){
		
			var anim1 = new TimelineMax({ repeat: -1, repeatDelay: 1 })
				.to(mesh.position, 3, {y: 0.3, ease: Sine.easeInOut})
				.to(mesh.position, 3, {y: 0, ease: Sine.easeInOut});
					
			var anim2 = new TimelineMax({ repeat: -1 })
				.to(mesh.rotation, 2, {y: -Math.PI/2, ease: Expo.easeOut, delay: 4})
				.to(mesh.rotation, 2, {y: -2*Math.PI/2, ease: Expo.easeOut, delay: 4})
				.to(mesh.rotation, 2, {y: -3*Math.PI/2, ease: Expo.easeOut, delay: 4})
				.to(mesh.rotation, 2, {y: -4*Math.PI/2, ease: Expo.easeOut, delay: 4});
			
		}
		
		

		
		
		var texturePlane = new THREE.TextureLoader().load('images/shadow.png');

		
		var materialPlane = new THREE.MeshBasicMaterial({
		  map: texturePlane, transparent: true
		});

		
		var geometryPlane = new THREE.PlaneGeometry(5, 1.5);

		
		var plane = new THREE.Mesh(geometryPlane, materialPlane);

		
		plane.position.set(0,-2,0);

		
		scene.add(plane);
		
		var anim3 = new TimelineMax({ repeat: -1, repeatDelay: 1 })
			.to(plane.scale, 3, {x: 1.3, ease: Sine.easeInOut})
			.to(plane.scale, 3, {x: 1, ease: Sine.easeInOut});
		
		
		ambientLight = new THREE.AmbientLight({color:0xffffff, wireframe:false});
		scene.add(ambientLight);
		
		var light = new THREE.PointLight(0xFFFFFF, 1, 500);
        light.position.set(10,0,25);
		
        scene.add(light);
		
		
		
		var render = function() {
            requestAnimationFrame(render);

	
			group.rotation.y += ( targetRotationX - group.rotation.y ) * 0.02;
			
			
			
			var cobinedRotation = group.rotation.y+mesh.rotation.y;
			cobinedRotation = cobinedRotation + Math.sign(cobinedRotation)*Math.PI/4;
			
			var activeSideNum = Math.trunc((cobinedRotation)/Math.PI*2);
			
			
			if ((activeSideNum>=0) && (activeSideNum<4)){
				activeSide = activeSideNum;
			} else {
				activeSideNum = activeSideNum%4;
				if (activeSideNum <0){
					activeSideNum = activeSideNum + 4;
				}
				activeSide = Math.abs(activeSideNum);
			}
			
			if (activeSide != activeSideOld){
				
				activeSideOld = activeSide;
				
				window["track_cube_side"+(activeSide+1)]();
				
			}
			
			
            renderer.render(scene, camera);
        };
		
	
		
		function snapTargetRotationX() {
			var coeff = Math.round(targetRotationX/Math.PI);
			
			targetRotationX = coeff*Math.PI;
		}
		
		function onDocumentMouseDown(event) {
			event.preventDefault();
			
			document.addEventListener( 'mousemove', onDocumentMouseMove, false );
			document.addEventListener( 'mouseup', onDocumentMouseUp, false );
			document.addEventListener( 'mouseout', onDocumentMouseOut, false );

			mouseXOnMouseDown = event.clientX - windowHalfX;
			targetRotationOnMouseDownX = targetRotationX;

			mouseYOnMouseDown = event.clientY - windowHalfY;
			targetRotationOnMouseDownY = targetRotationY;
			
		};
		
		function onDocumentMouseMove( event ) {
			mouseX = event.clientX - windowHalfX;
			mouseY = event.clientY - windowHalfY;

			targetRotationY = targetRotationOnMouseDownY + (mouseY - mouseYOnMouseDown) * 0.005;
			targetRotationX = targetRotationOnMouseDownX + (mouseX - mouseXOnMouseDown) * 0.005;
			
			
		};

		function onDocumentMouseUp( event ) {
			document.removeEventListener( 'mousemove', onDocumentMouseMove, false );
			document.removeEventListener( 'mouseup', onDocumentMouseUp, false );
			document.removeEventListener( 'mouseout', onDocumentMouseOut, false );
			
			mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
			mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
			raycaster.setFromCamera(mouse, camera);
			var intersects = raycaster.intersectObjects(scene.children, true);
			if (intersects.length > 0) {
				
				window["clickout_side"+(activeSide+1)]();
			}
			else {
				
				clickout_cta();
			}
		};

		function onDocumentMouseOut( event ) {
			document.removeEventListener( 'mousemove', onDocumentMouseMove, false );
			document.removeEventListener( 'mouseup', onDocumentMouseUp, false );
			document.removeEventListener( 'mouseout', onDocumentMouseOut, false );
		};

		function onDocumentTouchStart( event ) {
			if ( event.touches.length == 1 ) {
				
						
				mouseXOnMouseDown = event.touches[ 0 ].pageX - windowHalfX;
				targetRotationOnMouseDownX = targetRotationX;

				mouseYOnMouseDown = event.touches[ 0 ].pageY - windowHalfY;
				targetRotationOnMouseDownY = targetRotationY;
			}
		};

		function onDocumentTouchMove( event ) {
			if ( event.touches.length == 1 ) {
				

				mouseX = event.touches[ 0 ].pageX - windowHalfX;
				targetRotationX = targetRotationOnMouseDownX + ( mouseX - mouseXOnMouseDown ) * 0.005;

				mouseY = event.touches[ 0 ].pageY - windowHalfY;
				targetRotationY = targetRotationOnMouseDownY + (mouseY - mouseYOnMouseDown) * 0.005;
				
				
			}
		};
		
		document.addEventListener('mousedown', onDocumentMouseDown, false);
        document.addEventListener( 'touchstart', onDocumentTouchStart, false );
        document.addEventListener( 'touchmove', onDocumentTouchMove, false );

		render();
		
		
    </script>
	
  </body>
</html>

